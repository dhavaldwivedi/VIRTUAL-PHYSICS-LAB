<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motion in One Dimension (Realistic Building)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: #1e1e2f; 
            color: #e0e0e0; 
            margin: 0; 
            padding: 15px; 
            overflow-x: hidden; 
        }
        
        h2 { text-align: center; color: white; margin-top: 5px; }

        #dashboard { 
            display: flex; flex-wrap: wrap; gap: 15px; 
            max-width: 1200px; margin: 0 auto; width: 100%; 
        }

        .panel { 
            background: #2a2a40; padding: 20px; border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
            border: 1px solid rgba(255,255,255,0.05);
        }

        #controls { flex: 1 1 300px; }
        #sim { flex: 1 1 250px; display: flex; flex-direction: column; align-items: center;}
        #charts { flex: 2 1 400px; display: flex; flex-direction: column; gap: 15px; }

        .input-row { margin-bottom: 20px; }
        label { display: flex; justify-content: space-between; font-size: 14px; color: #b0bec5; font-weight: bold; }
        .val { color: #4fc3f7; font-family: monospace; font-size: 16px; }
        input[type="range"] { width: 100%; margin-top: 8px; accent-color: #4fc3f7; }
        button { 
            width: 100%; padding: 15px; background: #0288d1; color: white; 
            border: none; border-radius: 8px; font-size: 16px; font-weight: bold; 
            cursor: pointer; transition: background 0.2s;
        }
        button:hover { background: #0277bd; }

        canvas#simCanvas { 
            background: #1a1a2e; border-bottom: 4px solid #4fc3f7; 
            border-radius: 6px; width: 100%; max-width: 320px;
            height: 550px; display: block; 
        }

        .telemetry { display: flex; justify-content: space-between; margin-top: 15px; font-family: monospace; font-size: 14px; color: #81c784; }
        .math-box { 
            background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; 
            margin-top: 15px; font-family: 'Courier New', monospace; font-size: 13px; color: #ffd54f;
        }

        .chart-container { position: relative; height: 190px; width: 100%; background: #232336; border-radius: 8px; padding: 10px; }
        .math-line { display: flex; align-items: center; margin-bottom: 12px; white-space: nowrap; }
        .fraction { display: inline-flex; flex-direction: column; align-items: center; margin: 0 6px; font-size: 0.95em; }
        .fraction .num { padding: 0 4px; border-bottom: 1px solid #ffd54f; }
        .fraction .den { padding: 2px 4px 0 4px; }
    </style>
</head>
<body>

    <h2>Motion in One Dimension (Ball launched upwards)</h2>

    <img id="buildingSource" src="Gemini_Generated_Image_awyisyawyisyawyi.png" alt="Building Texture" style="display: none;">

    <div id="dashboard">
        <div class="panel" id="controls">
            <div class="input-row">
                <label>Initial Velocity (u) <span class="val" id="uVal">30.0 m/s</span></label>
                <input type="range" id="uSlider" min="5" max="30" step="0.5" value="30">
            </div>
            <div class="input-row">
                <label>Gravity (g) <span class="val" id="gVal">9.8 m/s²</span></label>
                <input type="range" id="gSlider" min="1.6" max="25" step="0.1" value="9.8">
            </div>
            <button id="launchBtn" onclick="launch()">LAUNCH SIMULATION</button>

            <div class="telemetry">
                <span>Time: <b id="tLive">0.00s</b></span>
                <span>Pos (y): <b id="yLive">0.00m</b></span>
                <span style="color:#ffb74d;">Vel (v): <b id="vLive">0.00m/s</b></span>
            </div>

            <div class="math-box" id="calcContent">
                <strong>Analytical Solutions:</strong><br><br>
                Set parameters and click launch.
            </div>
        </div>

        <div class="panel" id="sim">
            <canvas id="simCanvas" width="320" height="550"></canvas>
        </div>

        <div class="panel" id="charts">
            <div class="chart-container">
                <canvas id="posChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="velChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const buildingImg = document.getElementById('buildingSource');
        
        let animationId;
        let posChart, velChart;
        let isRunning = false;

        // --- GLOBAL CANVAS CONSTANTS ---
        const FIXED_MAX_METERS = 50;
        const groundY = canvas.height - 25; 
        const pxPerMeter = (canvas.height - 50) / FIXED_MAX_METERS; 
        const velScale = (canvas.height * 0.25) / 30; // Fixed vector scale

        const uSlider = document.getElementById('uSlider');
        const gSlider = document.getElementById('gSlider');

        // Update values and re-render initial state if we are not running
        uSlider.oninput = () => {
            document.getElementById('uVal').innerText = parseFloat(uSlider.value).toFixed(1) + " m/s";
            if (!isRunning) drawInitialState();
        };
        gSlider.oninput = () => {
            document.getElementById('gVal').innerText = parseFloat(gSlider.value).toFixed(1) + " m/s²";
        };

        Chart.defaults.color = '#a0a0b0';
        Chart.defaults.font.family = 'system-ui';
        
        const posCtx = document.getElementById('posChart').getContext('2d');
        posChart = new Chart(posCtx, {
            type: 'scatter',
            data: { datasets: [{ label: 'Position y(t) [m]', data: [], borderColor: '#4fc3f7', backgroundColor: 'rgba(79, 195, 247, 0.1)', showLine: true, fill: true, pointRadius: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'linear', display: false }, y: { beginAtZero: true } }, animation: false }
        });

        const velCtx = document.getElementById('velChart').getContext('2d');
        velChart = new Chart(velCtx, {
            type: 'scatter',
            data: { datasets: [{ label: 'Velocity v(t) [m/s]', data: [], borderColor: '#ffb74d', backgroundColor: 'rgba(255, 183, 77, 0.1)', showLine: true, fill: true, pointRadius: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'linear', title: { display: true, text: 'Time (s)' } } }, animation: false }
        });

        function drawVector(x, y, v) {
            if (Math.abs(v) < 0.5) return; 
            const length = v * velScale;
            ctx.strokeStyle = "#ffb74d"; ctx.fillStyle = "#ffb74d"; ctx.lineWidth = 3;
            ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x, y - length); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(x, y - length);
            const headOffset = v > 0 ? 6 : -6;
            ctx.lineTo(x - 6, y - length + headOffset); ctx.lineTo(x + 6, y - length + headOffset); ctx.fill();
        }

        function drawStopwatch(t) {
            ctx.fillStyle = "rgba(0, 0, 0, 0.6)";
            ctx.beginPath(); ctx.roundRect(canvas.width - 110, 10, 100, 35, 8); ctx.fill();
            ctx.fillStyle = "#fff"; ctx.font = "18px monospace"; ctx.textAlign = "right";
            ctx.fillText(`⏱️ ${t.toFixed(2)}s`, canvas.width - 20, 33);
        }

        // --- REWRITTEN BUILDING FUNCTION ---
        // Building now fills the launch area
        function drawBuilding() {
            const buildingHeightMeters = 60;
            const bHeightPx = buildingHeightMeters * pxPerMeter;
            const bX = 50; // Start right after the axis line
            const bWidthPx = canvas.width - bX; // Fill the rest of the canvas width
            const bY = groundY - bHeightPx + 30;

            if (!buildingImg.complete || buildingImg.naturalWidth === 0) {
                // Fallback drawing if image is missing
                ctx.fillStyle = "#2c3e50";
                ctx.fillRect(bX, bY, bWidthPx, bHeightPx);
                ctx.fillStyle = "#aaa"; ctx.textAlign = "center";
                ctx.fillText("[Building Image]", bX + (bWidthPx/2), groundY - (20 * pxPerMeter));
            } else {
                ctx.drawImage(buildingImg, bX, bY, bWidthPx, bHeightPx);
                
                // Add a subtle dark overlay to the building so the blue ball pops more
                ctx.fillStyle = "rgba(30, 30, 47, 0.3)"; 
                ctx.fillRect(bX, bY, bWidthPx, bHeightPx);
            }

            // Draw a thin roof line to cap it off
            ctx.strokeStyle = "#111"; ctx.lineWidth = 3;
            ctx.beginPath(); ctx.moveTo(bX, bY); ctx.lineTo(bX + bWidthPx, bY); ctx.stroke();
        }

        // --- NEW INITIAL STATE RENDERING ---
        function drawInitialState() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 1. Draw Background Building
            drawBuilding();

            // 2. Draw Y-Axis line and ticks
            ctx.beginPath(); ctx.strokeStyle = "rgba(255,255,255,0.4)"; ctx.lineWidth = 1;
            ctx.moveTo(45, 0); ctx.lineTo(45, canvas.height); ctx.stroke();

            ctx.fillStyle = "#b0bec5"; ctx.font = "12px monospace"; ctx.textAlign = "right";
            for(let m = 0; m <= FIXED_MAX_METERS; m += 5) {
                let tickY = groundY - (m * pxPerMeter);
                ctx.beginPath(); ctx.moveTo(40, tickY); ctx.lineTo(45, tickY); ctx.stroke();
                ctx.fillText(m + "m", 37, tickY + 4);
            }

            // 3. Draw Initial Ball on Ground
            const ballX = 185; // Centered on the background building
            const initialVelocity = parseFloat(uSlider.value);

            ctx.beginPath(); ctx.arc(ballX, groundY, 15, 0, Math.PI * 2); 
            ctx.fillStyle = "red"; ctx.fill();
            
            // Draw Initial Velocity Vector & Timer at 0
            drawVector(ballX, groundY, initialVelocity);
            drawStopwatch(0);
        }

        // Trigger the initial draw as soon as the image loads
        if(buildingImg.complete) {
            drawInitialState();
        } else {
            buildingImg.onload = drawInitialState;
            buildingImg.onerror = drawInitialState; // Draw fallback if it fails
        }

        function launch() {
            if (isRunning) return;
            cancelAnimationFrame(animationId);
            const u = parseFloat(uSlider.value); const g = parseFloat(gSlider.value);
            const tPeak = u / g; const hMax = (u * u) / (2 * g); const tTotal = tPeak * 2;

            document.getElementById('calcContent').innerHTML = `
                <div style="margin-bottom: 16px; font-weight:bold;">Solutions:</div>
                <div class="math-line">t_peak = <div class="fraction"><span class="num">${u}</span><span class="den">${g}</span></div> = <b>${tPeak.toFixed(2)}s</b></div>
                <div class="math-line">H_max = <div class="fraction"><span class="num">${u}²</span><span class="den">2 × ${g}</span></div> = <b>${hMax.toFixed(2)}m</b></div>
                <div class="math-line">Total Flight = 2 × t_peak = <b>${tTotal.toFixed(2)}s</b></div>
            `;
            posChart.data.datasets[0].data = []; velChart.data.datasets[0].data = [];
            posChart.options.scales.x.max = tTotal; velChart.options.scales.x.max = tTotal;
            posChart.update(); velChart.update();

            document.getElementById('launchBtn').innerText = "SIMULATION RUNNING...";
            document.getElementById('launchBtn').style.background = "#555";
            isRunning = true;
            animate(u, g, hMax, tPeak, tTotal);
        }

        function animate(u, g, hMax, tPeak, tTotal) {
            let startTime = performance.now();
            let lastChartUpdate = -1;

            function step(now) {
                let t = (now - startTime) / 1000; 
                if (t > tTotal) t = tTotal; 
                let y = (u * t) - (0.5 * g * Math.pow(t, 2));
                let v = u - (g * t);

                document.getElementById('tLive').innerText = t.toFixed(2) + "s";
                document.getElementById('yLive').innerText = y.toFixed(2) + "m";
                document.getElementById('vLive').innerText = v.toFixed(2) + "m/s";

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 1. Draw Background
                drawBuilding();

                // 2. Draw Axis and Ticks
                ctx.beginPath(); ctx.strokeStyle = "rgba(255,255,255,0.4)"; ctx.lineWidth = 1;
                ctx.moveTo(45, 0); ctx.lineTo(45, canvas.height); ctx.stroke();

                ctx.fillStyle = "#b0bec5"; ctx.font = "12px monospace"; ctx.textAlign = "right";
                for(let m = 0; m <= FIXED_MAX_METERS; m += 5) {
                    let tickY = groundY - (m * pxPerMeter);
                    ctx.beginPath(); ctx.moveTo(40, tickY); ctx.lineTo(45, tickY); ctx.stroke();
                    ctx.fillText(m + "m", 37, tickY + 4);
                }

                // 3. Draw Peak Marker (if reached)
                if (t >= tPeak && hMax <= FIXED_MAX_METERS) {
                    let peakY = groundY - (hMax * pxPerMeter);
                    ctx.setLineDash([5, 5]); ctx.strokeStyle = "#ff5252"; ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.moveTo(45, peakY); ctx.lineTo(canvas.width, peakY); ctx.stroke();
                    ctx.setLineDash([]); 
                    
                    // Add background box to make text readable over the building
                    ctx.fillStyle = "rgba(30,30,47,0.8)";
                    ctx.fillRect(150, peakY - 18, 120, 20);
                    ctx.fillStyle = "#ff5252"; ctx.textAlign = "left"; ctx.font = "bold 13px system-ui";
                    ctx.fillText(`H_max = ${hMax.toFixed(2)}m`, 155, peakY - 4);
                }

                // 4. Draw Ball and Vector
                let ballY = groundY - (y * pxPerMeter);
                let ballX = 185; 

                ctx.beginPath(); ctx.arc(ballX, ballY, 15, 0, Math.PI * 2); 
                ctx.fillStyle = "red"; ctx.fill();
                
                drawVector(ballX, ballY, v);
                drawStopwatch(t);

                // Chart Updating
                if (t - lastChartUpdate >= 0.05 || t === tTotal) {
                    lastChartUpdate = t;
                    posChart.data.datasets[0].data.push({x: t, y: y});
                    velChart.data.datasets[0].data.push({x: t, y: v});
                    posChart.update('none'); velChart.update('none');
                }

                if (t < tTotal) {
                    animationId = requestAnimationFrame(step);
                } else {
                    isRunning = false;
                    document.getElementById('launchBtn').innerText = "RESET & RELAUNCH";
                    document.getElementById('launchBtn').style.background = "#0288d1";
                    document.getElementById('yLive').innerText = "0.00m";
                    document.getElementById('vLive').innerText = (-u).toFixed(2) + "m/s";
                }
            }
            requestAnimationFrame(step);
        }
    </script>
</body>
</html>
