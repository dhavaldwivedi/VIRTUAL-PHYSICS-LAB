<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SHM Energy Conservation</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 1400px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    @media (min-width: 1024px) {
      .container {
        grid-template-columns: 450px 1fr;
        align-items: start;
      }
    }

    .left-col {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .panel {
      background: #1e293b;
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }

    .title {
      margin: 0 0 15px;
      font-size: 1.3rem;
      font-weight: 700;
      color: #f8fafc;
    }

    /* Simulation Canvas */
    .sim-wrap {
      width: 100%;
      background: #020617;
      border-radius: 12px;
      border: 1px solid #334155;
      overflow: hidden;
      margin-bottom: 5px;
    }
    #simCanvas { display: block; width: 100%; height: 200px; }

    /* Controls */
    .btn-row {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      flex: 1;
      border: none;
      border-radius: 8px;
      padding: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      color: white;
      transition: transform 0.1s;
    }
    button:active { transform: scale(0.96); }
    button.play { background: #10b981; }
    button.pause { background: #f59e0b; }
    button.reset { background: #ef4444; }

    .control-group {
      margin-bottom: 15px;
      background: #0f172a;
      padding: 12px 15px;
      border-radius: 10px;
      border: 1px solid #334155;
    }

    .control-group label {
      display: flex;
      justify-content: space-between;
      font-size: 1rem;
      font-weight: 600;
      color: #cbd5e1;
      margin-bottom: 8px;
    }

    .control-group input[type="range"] {
      width: 100%;
      cursor: pointer;
    }

    /* Telemetry Grid */
    .telemetry {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .telemetry .full-width {
      grid-column: span 3;
      display: flex;
      justify-content: space-around;
    }

    .data-box {
      background: #020617;
      border: 1px solid #334155;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }

    .data-box .label { font-size: 0.85rem; color: #94a3b8; margin-bottom: 4px; }
    .data-box .val { font-size: 1.15rem; font-weight: bold; }

    .val.x { color: #f8fafc; }
    .val.v { color: #f8fafc; }
    .val.ep { color: #3b82f6; } /* Blue */
    .val.ek { color: #10b981; } /* Green */
    .val.et { color: #fbbf24; } /* Yellow */

    /* Graph Canvas */
    .graph-wrap {
      width: 100%;
      background: #020617;
      border-radius: 12px;
      border: 1px solid #334155;
      overflow: hidden;
    }
    #graphCanvas { display: block; width: 100%; height: 500px; }

    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.95rem; font-weight: bold; color: #cbd5e1; }
    .color-box { width: 16px; height: 16px; border-radius: 4px; }

  </style>
</head>
<body>

  <div class="container">
    
    <div class="left-col">
      <section class="panel">
        <h2 class="title">Simulation View</h2>
        <div class="sim-wrap">
          <canvas id="simCanvas"></canvas>
        </div>
      </section>

      <section class="panel">
        <div class="btn-row">
          <button class="play" id="playBtn">Play</button>
          <button class="pause" id="pauseBtn">Pause</button>
          <button class="reset" id="resetBtn">Reset</button>
        </div>

        <div class="control-group" style="display: flex; align-items: center; justify-content: space-between;">
          <label for="slowMoCheck" style="margin-bottom: 0; cursor: pointer;">üê¢ Slow Motion (5x)</label>
          <input type="checkbox" id="slowMoCheck" style="width: 20px; height: 20px; cursor: pointer; margin: 0;">
        </div>

        <div class="control-group">
          <label>
            <span>Amplitude (A)</span>
            <span id="aVal">1.00 m</span>
          </label>
          <input type="range" id="aSlider" min="0.2" max="1.5" step="0.05" value="1.0">
        </div>

        <div class="control-group">
          <label>
            <span>Spring Constant (k)</span>
            <span id="kVal">20 N/m</span>
          </label>
          <input type="range" id="kSlider" min="5" max="50" step="1" value="20">
        </div>

        <div class="control-group">
          <label>
            <span>Mass (m)</span>
            <span id="mVal">2.0 kg</span>
          </label>
          <input type="range" id="mSlider" min="0.5" max="5.0" step="0.1" value="2.0">
        </div>

        <div class="telemetry">
          <div class="data-box">
            <div class="label">Displacement (x)</div>
            <div class="val x" id="xOut">0.00 m</div>
          </div>
          <div class="data-box">
            <div class="label">Velocity (v)</div>
            <div class="val v" id="vOut">0.00 m/s</div>
          </div>
          <div class="data-box">
            <div class="label">Total Energy (E)</div>
            <div class="val et" id="etOut">0.00 J</div>
          </div>
          <div class="full-width">
            <div class="data-box" style="flex: 1; margin-right: 5px;">
              <div class="label">Potential Energy (Ep)</div>
              <div class="val ep" id="epOut">0.00 J</div>
            </div>
            <div class="data-box" style="flex: 1; margin-left: 5px;">
              <div class="label">Kinetic Energy (Ek)</div>
              <div class="val ek" id="ekOut">0.00 J</div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <section class="panel" style="display: flex; flex-direction: column;">
      <h2 class="title">Energy vs. Displacement</h2>
      <div class="graph-wrap" style="flex-grow: 1;">
        <canvas id="graphCanvas"></canvas>
      </div>
      <div class="legend">
        <div class="legend-item"><div class="color-box" style="background: #fbbf24;"></div> Total Energy (E)</div>
        <div class="legend-item"><div class="color-box" style="background: #3b82f6;"></div> Potential (Ep)</div>
        <div class="legend-item"><div class="color-box" style="background: #10b981;"></div> Kinetic (Ek)</div>
      </div>
    </section>

  </div>

  <script>
    // --- STATE ---
    const state = {
      A: 1.0,      // Amplitude in meters
      k: 20,       // Spring constant in N/m
      m: 2.0,      // Mass in kg
      t: 0,        // Global time in seconds
      x: 1.0,      // Current displacement (m)
      v: 0,        // Current velocity (m/s)
      Ep: 10,      // Potential Energy (J)
      Ek: 0,       // Kinetic Energy (J)
      E: 10,       // Total Energy (J)
      playing: false,
      slowMo: false, // NEW: Tracks slow motion status
      lastTime: 0
    };

    // --- DOM ELEMENTS ---
    const els = {
      playBtn: document.getElementById('playBtn'),
      pauseBtn: document.getElementById('pauseBtn'),
      resetBtn: document.getElementById('resetBtn'),
      slowMoCheck: document.getElementById('slowMoCheck'), // NEW: Link to checkbox
      aSlider: document.getElementById('aSlider'),
      // ... (keep the rest of your existing elements)
      kSlider: document.getElementById('kSlider'),
      mSlider: document.getElementById('mSlider'),
      aVal: document.getElementById('aVal'),
      kVal: document.getElementById('kVal'),
      mVal: document.getElementById('mVal'),
      xOut: document.getElementById('xOut'),
      vOut: document.getElementById('vOut'),
      epOut: document.getElementById('epOut'),
      ekOut: document.getElementById('ekOut'),
      etOut: document.getElementById('etOut')
    };

    const simCanvas = document.getElementById('simCanvas');
    const simCtx = simCanvas.getContext('2d');
    const graphCanvas = document.getElementById('graphCanvas');
    const graphCtx = graphCanvas.getContext('2d');

    // --- SETUP & RESIZE ---
    function resizeCanvases() {
      const dpr = window.devicePixelRatio || 1;

      // Sim Canvas
      const simRect = simCanvas.parentElement.getBoundingClientRect();
      simCanvas.width = simRect.width * dpr;
      simCanvas.height = 200 * dpr;
      simCtx.scale(dpr, dpr);
      simCanvas.style.width = `${simRect.width}px`;
      simCanvas.style.height = `200px`;

      // Graph Canvas
      const graphRect = graphCanvas.parentElement.getBoundingClientRect();
      graphCanvas.width = graphRect.width * dpr;
      graphCanvas.height = 500 * dpr;
      graphCtx.scale(dpr, dpr);
      graphCanvas.style.width = `${graphRect.width}px`;
      graphCanvas.style.height = `500px`;

      if (!state.playing) drawAll();
    }
    window.addEventListener('resize', resizeCanvases);

    // --- PHYSICS CALCULATION ---
    function updatePhysics(dt) {
      if (!state.playing) return;
      
      state.t += dt;
      const omega = Math.sqrt(state.k / state.m);
      
      // Kinematic Equations
      state.x = state.A * Math.cos(omega * state.t);
      state.v = -state.A * omega * Math.sin(omega * state.t);
      
      // Energy Equations
      state.Ep = 0.5 * state.k * Math.pow(state.x, 2);
      state.Ek = 0.5 * state.m * Math.pow(state.v, 2);
      state.E = 0.5 * state.k * Math.pow(state.A, 2);
    }

    function calculateStaticEnergy() {
      // Used when paused or dragging sliders
      const omega = Math.sqrt(state.k / state.m);
      state.x = state.A * Math.cos(omega * state.t);
      state.v = -state.A * omega * Math.sin(omega * state.t);
      state.Ep = 0.5 * state.k * Math.pow(state.x, 2);
      state.Ek = 0.5 * state.m * Math.pow(state.v, 2);
      state.E = 0.5 * state.k * Math.pow(state.A, 2);
    }

    // --- DRAWING: SIMULATION ---
    function drawSimulation() {
      const w = simCanvas.clientWidth;
      const h = simCanvas.clientHeight;
      const ctx = simCtx;

      ctx.clearRect(0, 0, w, h);

      const centerY = h / 2 + 20;
      const eqX = w / 2;
      
      // Conversion: 1 meter = 80 pixels
      const pxPerMeter = 80; 
      const blockX = eqX + (state.x * pxPerMeter);
      const blockSize = 40;

      // Floor
      ctx.beginPath();
      ctx.moveTo(0, centerY + blockSize/2);
      ctx.lineTo(w, centerY + blockSize/2);
      ctx.strokeStyle = "#475569";
      ctx.lineWidth = 4;
      ctx.stroke();

      // Wall
      ctx.fillStyle = "#334155";
      ctx.fillRect(0, centerY - 40, 20, 80);

      // Equilibrium Line
      ctx.beginPath();
      ctx.setLineDash([5, 5]);
      ctx.moveTo(eqX, centerY - 60);
      ctx.lineTo(eqX, centerY + 60);
      ctx.strokeStyle = "#94a3b8";
      ctx.lineWidth = 1;
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle = "#94a3b8";
      ctx.font = "12px Arial";
      ctx.textAlign = "center";
      ctx.fillText("x = 0", eqX, centerY - 70);

      // Spring
      ctx.beginPath();
      ctx.strokeStyle = "#94a3b8";
      ctx.lineWidth = 3;
      const coils = 12;
      const startX = 20;
      const endX = blockX - blockSize/2;
      const step = (endX - startX) / coils;
      ctx.moveTo(startX, centerY);
      for (let i = 0; i < coils; i++) {
        const cx = startX + step * i;
        const nextX = startX + step * (i + 1);
        const midX = (cx + nextX) / 2;
        const sign = i % 2 === 0 ? 1 : -1;
        ctx.lineTo(midX, centerY + 12 * sign);
        ctx.lineTo(nextX, centerY);
      }
      ctx.stroke();

      // Block
      ctx.fillStyle = "#3b82f6";
      ctx.fillRect(blockX - blockSize/2, centerY - blockSize/2, blockSize, blockSize);
      ctx.fillStyle = "#ffffff";
      ctx.font = "bold 14px Arial";
      ctx.fillText(`${state.m.toFixed(1)}`, blockX, centerY + 5);
    }

    // --- DRAWING: GRAPH ---
// --- DRAWING: GRAPH ---
    function drawGraph() {
      const w = graphCanvas.clientWidth;
      const h = graphCanvas.clientHeight;
      const ctx = graphCtx;

      ctx.clearRect(0, 0, w, h);

      // Increased top padding slightly to accommodate the paused text
      const padL = 50, padR = 30, padT = 50, padB = 40; 
      const drawW = w - padL - padR;
      const drawH = h - padT - padB;
      const originX = padL + (drawW / 2);
      const originY = h - padB;

      // Graph bounds mapping
      const xMaxScale = 1.6; // X-axis spans from -1.6m to +1.6m
      const eMaxScale = Math.max(0.5 * 50 * Math.pow(1.5, 2), state.E * 1.2); 

      // Helper functions for coordinates
      const getXpx = (xm) => originX + (xm / xMaxScale) * (drawW / 2);
      const getYpx = (ej) => originY - (ej / eMaxScale) * drawH;

      // Draw Grid & Axes
      ctx.lineWidth = 1;
      ctx.strokeStyle = "#334155";
      ctx.fillStyle = "#94a3b8";
      ctx.font = "12px Arial";

      // Y-Axis
      ctx.beginPath();
      ctx.moveTo(originX, padT - 20);
      ctx.lineTo(originX, originY);
      ctx.stroke();

      // X-Axis
      ctx.beginPath();
      ctx.moveTo(padL, originY);
      ctx.lineTo(w - padR, originY);
      ctx.stroke();

      // Axis Labels & Units (Meters and Joules)
      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      ctx.fillText("0", originX, originY + 8);
      ctx.fillText("+" + state.A.toFixed(2) + " m", getXpx(state.A), originY + 8);
      ctx.fillText("-" + state.A.toFixed(2) + " m", getXpx(-state.A), originY + 8);
      
      ctx.textAlign = "right";
      ctx.textBaseline = "bottom"; // This draws the text above the line instead of cutting through it
      ctx.font = "bold 14px Arial"; // Increases the font size and makes it bold
      // Subtracting 4 from the Y-coordinate lifts it just a bit higher off the line
      ctx.fillText(state.E.toFixed(1) + " J", originX - 10, getYpx(state.E) - 4); 
      
      // Reset the font back to normal for the rest of the text
      ctx.font = "12px Arial";

      // Axis Titles
      ctx.textAlign = "left";
      ctx.fillStyle = "#cbd5e1";
      ctx.fillText("Energy (J)", originX + 10, padT - 35);
      
      ctx.textAlign = "right";
      ctx.fillText("x (m)", w - padR, originY - 10);

      // Draw Total Energy (Horizontal Line)
      const ePxY = getYpx(state.E);
      ctx.beginPath();
      ctx.strokeStyle = "#fbbf24"; // Gold
      ctx.lineWidth = 3;
      ctx.setLineDash([8, 4]);
      ctx.moveTo(getXpx(-state.A), ePxY);
      ctx.lineTo(getXpx(state.A), ePxY);
      ctx.stroke();
      ctx.setLineDash([]);

      // Draw Potential Energy (Ep) Parabola
      ctx.beginPath();
      ctx.strokeStyle = "#3b82f6"; // Blue
      ctx.lineWidth = 3;
      for(let xm = -state.A; xm <= state.A; xm += 0.02) {
        const ep = 0.5 * state.k * Math.pow(xm, 2);
        if(xm === -state.A) ctx.moveTo(getXpx(xm), getYpx(ep));
        else ctx.lineTo(getXpx(xm), getYpx(ep));
      }
      ctx.stroke();

      // Draw Kinetic Energy (Ek) Inverted Parabola
      ctx.beginPath();
      ctx.strokeStyle = "#10b981"; // Green
      ctx.lineWidth = 3;
      for(let xm = -state.A; xm <= state.A; xm += 0.02) {
        const ek = state.E - (0.5 * state.k * Math.pow(xm, 2));
        if(xm === -state.A) ctx.moveTo(getXpx(xm), getYpx(ek));
        else ctx.lineTo(getXpx(xm), getYpx(ek));
      }
      ctx.stroke();

      // --- LIVE TRACKER ---
      const currXpx = getXpx(state.x);
      
      // Vertical line
      ctx.beginPath();
      ctx.moveTo(currXpx, originY);
      ctx.lineTo(currXpx, ePxY);
      ctx.strokeStyle = "rgba(255, 255, 255, 0.4)";
      ctx.lineWidth = 2;
      ctx.stroke();

      // Dot for Ep
      ctx.beginPath();
      ctx.arc(currXpx, getYpx(state.Ep), 6, 0, Math.PI*2);
      ctx.fillStyle = "#020617";
      ctx.fill();
      ctx.strokeStyle = "#3b82f6";
      ctx.lineWidth = 3;
      ctx.stroke();

      // Dot for Ek
      ctx.beginPath();
      ctx.arc(currXpx, getYpx(state.Ek), 6, 0, Math.PI*2);
      ctx.fillStyle = "#020617";
      ctx.fill();
      ctx.strokeStyle = "#10b981";
      ctx.lineWidth = 3;
      ctx.stroke();

      // Dot for Total E
      ctx.beginPath();
      ctx.arc(currXpx, getYpx(state.E), 6, 0, Math.PI*2);
      ctx.fillStyle = "#020617";
      ctx.fill();
      ctx.strokeStyle = "#fbbf24";
      ctx.lineWidth = 3;
      ctx.stroke();

      // --- PAUSED OVERLAY (in Joules) ---
      if (!state.playing) {
        ctx.font = "bold 16px Arial";
        
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.fillStyle = "#3b82f6"; // Blue Ep
        ctx.fillText(`Ep = ${state.Ep.toFixed(2)} J`, padL, padT - 35);
        
        ctx.textAlign = "right";
        ctx.fillStyle = "#10b981"; // Green Ek
        ctx.fillText(`Ek = ${state.Ek.toFixed(2)} J`, w - padR, padT - 35);
      }
    }

    // --- MASTER UPDATE ---
    function drawAll() {
      drawSimulation();
      drawGraph();

      // Update Telemetry
      els.xOut.textContent = state.x.toFixed(2) + " m";
      els.vOut.textContent = state.v.toFixed(2) + " m/s";
      els.epOut.textContent = state.Ep.toFixed(2) + " J";
      els.ekOut.textContent = state.Ek.toFixed(2) + " J";
      els.etOut.textContent = state.E.toFixed(2) + " J";
    }

 // --- NEW: Slow Motion Event ---
    els.slowMoCheck.addEventListener('change', (e) => {
      state.slowMo = e.target.checked;
    });

    // --- ANIMATION LOOP ---
    function animate(timestamp) {
      if (!state.playing) return;
      
      const realDt = (timestamp - state.lastTime) / 1000;
      state.lastTime = timestamp;
      
      if (realDt < 0.1) {
        // If slowMo is true, multiply time by 0.2 to run 5x slower
        const dt = state.slowMo ? realDt * 0.2 : realDt; 
        updatePhysics(dt);
        drawAll();
      }
      requestAnimationFrame(animate);
    }

    // --- EVENTS ---
    els.playBtn.addEventListener('click', () => {
      if (!state.playing) {
        state.playing = true;
        state.lastTime = performance.now();
        requestAnimationFrame(animate);
      }
    });

   
    els.pauseBtn.addEventListener('click', () => { 
      state.playing = false; 
      drawAll(); // Force a final redraw to show the paused overlay
    });

    els.resetBtn.addEventListener('click', () => {
      state.playing = false;
      state.t = 0;
      calculateStaticEnergy();
      drawAll();
    });

    function updateInputs() {
      state.A = parseFloat(els.aSlider.value);
      state.k = parseFloat(els.kSlider.value);
      state.m = parseFloat(els.mSlider.value);
      
      els.aVal.textContent = `${state.A.toFixed(2)} m`;
      els.kVal.textContent = `${state.k} N/m`;
      els.mVal.textContent = `${state.m.toFixed(1)} kg`;

      if (!state.playing) {
        state.t = 0; // Reset position to max amplitude to show curve change
        calculateStaticEnergy();
        drawAll();
      }
    }

    els.aSlider.addEventListener('input', updateInputs);
    els.kSlider.addEventListener('input', updateInputs);
    els.mSlider.addEventListener('input', updateInputs);

    // --- INIT ---
    setTimeout(() => {
      resizeCanvases();
      calculateStaticEnergy();
      drawAll();
    }, 50);

  </script>
</body>
</html>
