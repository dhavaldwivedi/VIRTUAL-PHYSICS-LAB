<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ohm's Law Unknown Resistance Experiment</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      padding: 12px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .panel {
      background: #1e293b;
      border-radius: 14px;
      padding: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }

    .title {
      margin: 0 0 10px;
      font-size: 1.3rem; 
      font-weight: 700;
      color: #f8fafc;
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .control {
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 10px;
      padding: 12px;
    }

    .control label {
      display: block;
      font-size: 1.1rem; 
      margin-bottom: 8px;
      color: #cbd5e1;
      font-weight: 600;
    }

    .input-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    .input-row input[type="number"] {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #475569;
      background: #020617;
      color: #e2e8f0;
      font-size: 1.2rem; 
    }

    select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #475569;
      background: #020617;
      color: #e2e8f0;
      font-size: 1.1rem;
      cursor: pointer;
      outline: none;
    }
    
    select:focus {
      border-color: #3b82f6;
    }

    .unit {
      min-width: 52px;
      text-align: center;
      font-size: 1.1rem; 
      color: #94a3b8;
      font-weight: bold;
    }

    input[type="range"] {
      width: 100%;
      height: 28px;
      background: transparent;
      cursor: pointer;
    }

    .meta {
      font-size: 1.05rem; 
      color: #94a3b8;
      line-height: 1.5;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 12px 14px;
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      color: white;
      background: #2563eb;
      min-height: 44px;
      transition: background 0.2s, transform 0.1s;
    }

    button.success { background: #16a34a; }
    button.secondary { background: #475569; }
    button.danger { background: #dc2626; }
    button:active { transform: scale(0.98); }

    .canvas-wrap {
      width: 100%;
      overflow: hidden;
      border-radius: 12px;
      border: 1px solid #334155;
      background: #020617;
      position: relative;
    }

    canvas {
      display: block;
      width: 100%;
      height: 360px;
      touch-action: none;
    }

    .bottom-stack {
      display: grid;
      gap: 12px;
      margin-top: 12px;
    }

    .equations-panel {
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 12px;
    }

    .eq-title {
      margin: 0 0 10px;
      font-size: 1.15rem; 
      font-weight: 700;
      color: #f8fafc;
    }

    .eq-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .eq-card {
      background: #020617;
      border: 1px solid #334155;
      border-radius: 10px;
      padding: 12px;
      font-size: 1.1rem; 
      line-height: 1.45;
      min-height: 90px;
    }

    .eq-card .formula {
      color: #93c5fd;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .eq-card .sub {
      color: #cbd5e1;
    }

    .eq-card .ans {
      color: #86efac;
      font-weight: 700;
      margin-top: 6px;
      font-size: 1.25rem; 
    }

    .eq-card .off-text {
      color: #ef4444;
    }

    /* Observation Table Styles */
    .obs-table-wrapper {
      margin-top: 15px;
      overflow-x: auto;
    }
    .obs-table {
      width: 100%;
      border-collapse: collapse;
      color: #e2e8f0;
      font-size: 1.05rem;
    }
    .obs-table th, .obs-table td {
      border: 1px solid #334155;
      padding: 10px;
      text-align: center;
    }
    .obs-table th {
      background: #020617;
      color: #93c5fd;
      font-weight: 600;
    }
    .obs-table tbody tr:nth-child(even) { background: #0f172a; }
    .obs-table tbody tr:nth-child(odd) { background: #1e293b; }

    @media (min-width: 860px) {
      .container {
        grid-template-columns: 300px 1fr;
        align-items: start;
      }

      canvas {
        height: 420px;
      }

      .controls {
        max-height: 82vh;
        overflow: auto;
        padding-right: 4px;
      }

      .eq-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <section class="panel">
      <h2 class="title">Circuit Controls</h2>
      <div class="controls">

        <div class="control">
          <label>Main Switch</label>
          <button id="switchBtn" class="danger" style="width: 100%;">Turn Circuit ON</button>
        </div>

        <div class="control">
          <label>Flow Direction</label>
          <div class="btn-row" style="margin-top: 0;">
            <button id="convBtn" class="success" style="flex:1">Conventional</button>
            <button id="elecBtn" class="secondary" style="flex:1">Electron</button>
          </div>
        </div>

        <div class="control">
          <label for="voltageInput">Voltage Source (V)</label>
          <div class="input-row">
            <input type="number" id="voltageInput" min="0.1" max="24.0" step="0.1" value="9.0">
            <span class="unit">V</span>
          </div>
          <input type="range" id="voltageSlider" min="0.1" max="24.0" step="0.1" value="9.0">
        </div>

        <div class="control">
          <label for="resistorSelect">Resistor (R)</label>
          <select id="resistorSelect">
            <option value="5">Unknown Resistor 1</option>
            <option value="10" selected>Unknown Resistor 2</option>
            <option value="20">Unknown Resistor 3</option>
            <option value="50">Unknown Resistor 4</option>
            <option value="100">Unknown Resistor 5</option>
          </select>
        </div>

        <div class="meta">
          <strong>Experiment Logic:</strong>
          <br>• Turn the circuit <b>ON</b> to measure current.
          <br>• Change <b>Voltage (V)</b> to see how it affects the flow of charge through the unknown resistor.
          <br>• Record your readings to calculate the unknown resistance using Ohm's Law (<b>R = V / I</b>).
        </div>
      </div>
    </section>

    <section class="panel">
      <h2 class="title">Ohm's Law Experiment</h2>
      <div class="canvas-wrap">
        <canvas id="circuitCanvas"></canvas>
      </div>

      <div class="bottom-stack">
        <div class="equations-panel">
          <h3 class="eq-title">Real-Time Calculations & Observations</h3>
          
          <div class="eq-grid">
            <div class="eq-card">
              <div class="formula">1) Resistance Formula</div>
              <div class="ans">R = V / I</div>
              <div class="sub" style="margin-top: 4px; font-size: 0.9em;">Derived from Ohm's Law (V = IR)</div>
            </div>

            <div class="eq-card">
              <div class="formula">2) Resistance Calculation</div>
              <div class="sub" id="eqRSub">Switch is Open</div>
              <div class="ans off-text" id="eqRAns">Current is 0 A</div>
            </div>
          </div>

          <div class="obs-table-wrapper">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <h4 style="margin: 0; color: #cbd5e1;">Observation Log</h4>
              <div style="display: flex; gap: 8px;">
                <button id="clearBtn" class="secondary" style="min-height: 30px; padding: 6px 12px; font-size: 0.95rem;">Clear</button>
                <button id="recordBtn" class="success" style="min-height: 30px; padding: 6px 12px; font-size: 0.95rem;">Record Reading</button>
              </div>
            </div>
            <table id="obsTable" class="obs-table">
              <thead>
                <tr>
                  <th>Resistor</th>
                  <th>Voltage (V)</th>
                  <th>Current (I)</th>
                  <th>Calculated R (Ω)</th>
                </tr>
              </thead>
              <tbody>
                </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ======== STATE ========
    const state = {
      V: 9.0,        // Volts
      R: 10.0,       // Ohms (Selected)
      I: 0.9,        // Amperes (Calculated)
      flowDir: 1,    // 1 for Conventional, -1 for Electron
      switchOn: false // Starts OFF
    };

    // ======== DOM ELEMENTS ========
    const canvas = document.getElementById("circuitCanvas");
    const ctx = canvas.getContext("2d");

    const els = {
      switchBtn: document.getElementById("switchBtn"),

      vInput: document.getElementById("voltageInput"),
      vSlider: document.getElementById("voltageSlider"),
      rSelect: document.getElementById("resistorSelect"),
      
      convBtn: document.getElementById("convBtn"),
      elecBtn: document.getElementById("elecBtn"),

      eqRSub: document.getElementById("eqRSub"),
      eqRAns: document.getElementById("eqRAns"),

      recordBtn: document.getElementById("recordBtn"),
      clearBtn: document.getElementById("clearBtn"),
      obsTableBody: document.querySelector("#obsTable tbody")
    };

    // ======== HELPERS ========
    function clamp(val, min, max) {
      return Math.min(max, Math.max(min, val));
    }

    function resizeCanvas() {
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function syncUI() {
      // Calculate Current based on V and R
      state.I = state.V / state.R;

      // Update Voltage Inputs/Sliders
      els.vInput.value = state.V.toFixed(1);
      els.vSlider.value = state.V;

      // Update Switch Button
      if (state.switchOn) {
        els.switchBtn.className = "success";
        els.switchBtn.textContent = "Circuit is ON (Close Switch)";
      } else {
        els.switchBtn.className = "danger";
        els.switchBtn.textContent = "Circuit is OFF (Open Switch)";
      }

      // Update Flow Direction Buttons
      if (state.flowDir === 1) {
        els.convBtn.className = "success";
        els.elecBtn.className = "secondary";
      } else {
        els.convBtn.className = "secondary";
        els.elecBtn.className = "success";
      }

      // Update Equations Based on Switch State
      if (state.switchOn) {
        els.eqRSub.textContent = `R = ${state.V.toFixed(1)} V / ${state.I.toFixed(2)} A`;
        els.eqRAns.textContent = `R = ${state.R.toFixed(1)} Ω`;
        els.eqRAns.className = "ans"; 
      } else {
        els.eqRSub.textContent = `Switch is Open (I = 0.00 A)`;
        els.eqRAns.textContent = `R = Undefined (Div by 0)`;
        els.eqRAns.className = "ans off-text"; 
      }
    }

    function updateVoltage(val) {
      state.V = clamp(val, 0.1, 24.0);
    }

    function bindPair(inputEl, sliderEl, callback) {
      const apply = (raw) => {
        const val = parseFloat(raw);
        if (!isFinite(val)) return;
        callback(val);
        syncUI();
      };
      inputEl.addEventListener("input", e => apply(e.target.value));
      sliderEl.addEventListener("input", e => apply(e.target.value));
    }

    // ======== EVENT LISTENERS ========
    els.switchBtn.addEventListener("click", () => {
      state.switchOn = !state.switchOn;
      syncUI();
    });

    bindPair(els.vInput, els.vSlider, updateVoltage);
    
    els.rSelect.addEventListener("change", (e) => {
      state.R = parseFloat(e.target.value);
      syncUI();
    });

    els.convBtn.addEventListener("click", () => {
      state.flowDir = 1;
      syncUI();
    });

    els.elecBtn.addEventListener("click", () => {
      state.flowDir = -1;
      syncUI();
    });

    els.recordBtn.addEventListener("click", () => {
      if (!state.switchOn) {
        alert("Please turn the circuit ON to record a reading.");
        return;
      }
      const resName = els.rSelect.options[els.rSelect.selectedIndex].text;
      
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${resName}</td>
        <td>${state.V.toFixed(1)} V</td>
        <td>${state.I.toFixed(2)} A</td>
        <td style="color: #86efac; font-weight: bold;">${state.R.toFixed(1)} &Omega;</td>
      `;
      els.obsTableBody.appendChild(tr);
    });

    els.clearBtn.addEventListener("click", () => {
      els.obsTableBody.innerHTML = '';
    });

    // ======== CIRCUIT DRAWING CONFIG ========
    const circWidth = 400;
    const circHeight = 220;
    let cx, cy, startX, startY;
    const pathLength = (circWidth * 2) + (circHeight * 2);

    const numParticles = 35;
    const particles = Array.from({ length: numParticles }, (_, i) => ({
      d: (i / numParticles) * pathLength
    }));

    // ======== DRAW FUNCTIONS ========
    function getPointOnCircuit(d) {
      d = d % pathLength;
      if (d < 0) d += pathLength;

      if (d <= circWidth) {
        return { x: startX + d, y: startY };
      } else if (d <= circWidth + circHeight) {
        let x = startX + circWidth;
        let y = startY + (d - circWidth);
        
        let resY = startY + circHeight / 2;
        if (y >= resY - 40 && y <= resY + 40) {
          let localY = y - (resY - 40); 
          let xOffset = 0;
          
          if (localY <= 10) {
            xOffset = (localY / 10) * 18;
          } else if (localY <= 30) {
            xOffset = 18 - ((localY - 10) / 20) * 36;
          } else if (localY <= 50) {
            xOffset = -18 + ((localY - 30) / 20) * 36;
          } else if (localY <= 70) {
            xOffset = 18 - ((localY - 50) / 20) * 36;
          } else {
            xOffset = -18 + ((localY - 70) / 10) * 18;
          }
          x += xOffset;
        }
        return { x: x, y: y };
      } else if (d <= (circWidth * 2) + circHeight) {
        return { x: startX + circWidth - (d - circWidth - circHeight), y: startY + circHeight };
      } else {
        return { x: startX, y: startY + circHeight - (d - (circWidth * 2) - circHeight) };
      }
    }

    function drawCircuitBase() {
      ctx.strokeStyle = "#475569";
      ctx.lineWidth = 4;
      ctx.lineJoin = "round";

      ctx.beginPath();
      ctx.rect(startX, startY, circWidth, circHeight);
      ctx.stroke();

      // --- Switch ---
      const swX = startX + circWidth / 2;
      const swY = startY + circHeight;

      ctx.clearRect(swX - 25, swY - 20, 50, 40);

      ctx.fillStyle = "#94a3b8";
      ctx.beginPath();
      ctx.arc(swX - 18, swY, 5, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(swX + 18, swY, 5, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = "#cbd5e1";
      ctx.lineWidth = 4;
      ctx.lineCap = "round";
      ctx.beginPath();
      ctx.moveTo(swX - 18, swY);
      
      if (state.switchOn) {
        ctx.lineTo(swX + 18, swY); 
      } else {
        ctx.lineTo(swX + 12, swY - 22); 
      }
      ctx.stroke();
      ctx.lineCap = "butt"; 

      // --- Battery ---
      const batY = startY + circHeight / 2;
      ctx.clearRect(startX - 5, batY - 25, 10, 50);
      
      ctx.strokeStyle = "#ef4444";
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(startX - 24, batY - 12);
      ctx.lineTo(startX + 24, batY - 12);
      ctx.stroke();
      
      ctx.strokeStyle = "#3b82f6";
      ctx.lineWidth = 10;
      ctx.beginPath();
      ctx.moveTo(startX - 12, batY + 12);
      ctx.lineTo(startX + 12, batY + 12);
      ctx.stroke();

      ctx.fillStyle = "#ef4444";
      ctx.font = "bold 18px Arial";
      ctx.fillText("+", startX - 35, batY - 6);
      
      ctx.fillStyle = "#3b82f6";
      ctx.font = "bold 20px Arial";
      ctx.fillText("-", startX - 35, batY + 18);

      // --- Resistor ---
      const resY = startY + circHeight / 2;
      const glowIntensity = state.switchOn ? Math.min(1, state.I / 2.5) : 0; 
      
      const rColor = Math.round(56 + (249 - 56) * glowIntensity);
      const gColor = Math.round(189 - (189 - 115) * glowIntensity);
      const bColor = Math.round(248 - (248 - 22) * glowIntensity);
      const resistorColor = `rgb(${rColor}, ${gColor}, ${bColor})`;

      ctx.clearRect(startX + circWidth - 5, resY - 40, 10, 80);

      ctx.strokeStyle = resistorColor;
      ctx.lineWidth = 3 + (glowIntensity * 2); 
      ctx.shadowColor = resistorColor;
      ctx.shadowBlur = 12 * glowIntensity;

      ctx.beginPath();
      ctx.moveTo(startX + circWidth, resY - 40);
      ctx.lineTo(startX + circWidth + 18, resY - 30);
      ctx.lineTo(startX + circWidth - 18, resY - 10);
      ctx.lineTo(startX + circWidth + 18, resY + 10);
      ctx.lineTo(startX + circWidth - 18, resY + 30);
      ctx.lineTo(startX + circWidth, resY + 40);
      ctx.stroke();
      ctx.shadowBlur = 0;

      // --- Ammeter ---
      const amX = startX + circWidth / 2;
      ctx.clearRect(amX - 25, startY - 25, 50, 50);
      
      ctx.beginPath();
      ctx.arc(amX, startY, 24, 0, Math.PI * 2);
      ctx.fillStyle = "#1e293b";
      ctx.fill();
      ctx.strokeStyle = "#10b981";
      ctx.lineWidth = 3;
      ctx.stroke();

      ctx.fillStyle = "#10b981";
      ctx.font = "bold 22px Arial"; 
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("A", amX, startY - 2);

      const displayI = state.switchOn ? state.I : 0.0;
      ctx.font = "bold 16px Arial"; 
      ctx.fillText(`${displayI.toFixed(2)} A`, amX, startY - 42);

      // --- Voltmeter ---
      const vmX = startX - 70;
      const vmY = batY;

      ctx.strokeStyle = "#94a3b8";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(startX, batY - 45);
      ctx.lineTo(vmX, batY - 45);
      ctx.lineTo(vmX, vmY - 24);
      
      ctx.moveTo(startX, batY + 45);
      ctx.lineTo(vmX, batY + 45);
      ctx.lineTo(vmX, vmY + 24);
      ctx.stroke();

      ctx.beginPath();
      ctx.arc(vmX, vmY, 24, 0, Math.PI * 2);
      ctx.fillStyle = "#1e293b";
      ctx.fill();
      ctx.strokeStyle = "#eab308";
      ctx.lineWidth = 3;
      ctx.stroke();

      ctx.fillStyle = "#eab308";
      ctx.font = "bold 22px Arial"; 
      ctx.fillText("V", vmX, vmY - 2);

      ctx.font = "bold 16px Arial"; 
      ctx.textAlign = "right";
      ctx.fillText(`${state.V.toFixed(1)} V`, vmX - 35, vmY);
      
      // Label Resistor
      // Label Resistor
      ctx.fillStyle = resistorColor;
      ctx.textAlign = "center"; // Centers the text alongside the resistor
      ctx.font = "bold 16px Arial"; 
      const resName = els.rSelect.options[els.rSelect.selectedIndex].text;
      
      ctx.save(); // Saves the current unrotated canvas state
      ctx.translate(startX + circWidth + 35, resY); // Moves origin slightly to the right of the resistor
      ctx.rotate(-Math.PI / 2); // Rotates the grid 90 degrees counter-clockwise
      ctx.fillText(resName, 0, 0); // Draws the text at the new rotated origin
      ctx.restore(); // Restores the canvas back to normal for the next frame
    }

    function drawParticles() {
      if (!state.switchOn) {
        ctx.fillStyle = "#475569"; 
        ctx.shadowBlur = 0;
      } else {
        if (state.flowDir === 1) {
          ctx.fillStyle = "#fbbf24"; 
          ctx.shadowColor = "#f59e0b";
        } else {
          ctx.fillStyle = "#60a5fa"; 
          ctx.shadowColor = "#3b82f6";
        }
        ctx.shadowBlur = 10;
      }

      for (let p of particles) {
        const pos = getPointOnCircuit(p.d);
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, 5, 0, Math.PI * 2);
        ctx.fill();
      }

      ctx.shadowBlur = 0;
    }

    // ======== ANIMATION ========
    let lastTime = 0;

    function animate(nowMs) {
      const now = nowMs / 1000;
      if (!lastTime) lastTime = now;
      const dt = now - lastTime;
      lastTime = now;

      const baseSpeed = 150; 
      const currentSpeed = state.switchOn ? (state.I * baseSpeed * state.flowDir) : 0;

      for (let p of particles) {
        p.d = (p.d + currentSpeed * dt) % pathLength;
        if (p.d < 0) p.d += pathLength;
      }

      ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
      
      const safeWidth = 620; 
      const scale = canvas.clientWidth < safeWidth ? canvas.clientWidth / safeWidth : 1;

      ctx.save();
      ctx.scale(scale, scale); 

      cx = (canvas.clientWidth / scale) / 2;
      cy = (canvas.clientHeight / scale) / 2;
      
      startX = cx - (circWidth / 2) + 15; 
      startY = cy - (circHeight / 2);

      drawCircuitBase();
      drawParticles();

      ctx.restore();

      requestAnimationFrame(animate);
    }

    // ======== INIT ========
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    syncUI();
    requestAnimationFrame(animate);
  </script>
</body>
</html>
